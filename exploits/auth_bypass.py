#!/usr/bin/python
from bs4 import BeautifulSoup
import sys, requests, re

def get_status(page):
    URL = 'http://'+ip+'/cgi-bin/luci/'
    session = requests.session()
    if page is not None:
        r = session.get(URL+page)
        return r.status_code

def auth_get(page):

    URL = 'http://'+ip+'/cgi-bin/luci/'
    payload = {
        'luci_username': 'root',
        'luci_password': 'admin',
        }
    session = requests.session()
    r = session.post(URL+page, data=payload)
    return r.text

def main():
   
    if len(sys.argv) != 2:
        print(sys.argv[0]+" <ip-address>")
        return
    else:
        global ip
        ip = sys.argv[1]

    p = re.compile(ur"(/;stok=[a-f0-9]{32})")

    root_page = auth_get("")
    soup = BeautifulSoup(root_page)
    for link in soup.find_all('a'):
        href = link.get('href')
        if href is not None:
            href = re.sub(p, "", href)
            print(href)
            print(get_status(href))

main()
